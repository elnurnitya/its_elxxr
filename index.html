<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kartu Natal & Tahun Baru â€” Interactive Template</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root{--bg:#0b0b0b;--card:#111;--red:#d62828;--white:#fff;--muted:#b8c2cf}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#070707,#0b1320);color:var(--white);font-family:Montserrat,system-ui,Arial;padding:18px}

    /* layout */
    .wrap{max-width:980px;margin:0 auto}
    .center{display:flex;align-items:center;justify-content:center}

    /* popup name */
    #nameModal{position:fixed;inset:0;background:linear-gradient(rgba(3,3,3,0.85),rgba(3,3,3,0.85));z-index:9999;display:flex;align-items:center;justify-content:center}
    .modal-card{background:linear-gradient(180deg,#121212,#0f0f12);padding:26px;border-radius:16px;border:2px solid rgba(214,40,40,0.12);width:94%;max-width:420px;text-align:center;box-shadow:0 8px 40px rgba(0,0,0,0.7)}
    .modal-card h2{font-family:Pacifico;color:var(--red);margin:0 0 8px}
    .modal-card input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:none;background:var(--red);color:#fff;cursor:pointer;margin-top:12px}

    /* global card style */
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:22px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6);margin:18px 0}
    .card.small{max-width:420px;margin:12px auto}
    .card-title{font-family:Pacifico;color:var(--red);font-size:22px;margin:0 0 6px}
    p.lead{margin:0;color:var(--muted)}

    /* greeting card */
    #greetingCard{display:none;cursor:pointer}
    #greetingCard .inner{padding:18px;border-radius:12px;background:linear-gradient(180deg,#120a0a,#0c0c0c);border:1px solid rgba(214,40,40,0.12)}
    #greetingCard h1{font-family:Pacifico;color:var(--red);margin:0 0 6px}
    #greetingCard .name{font-weight:700;font-size:18px;color:var(--white)}

    /* message */
    #messageCard{display:none}

    /* tree area */
    #treeCard{display:none;text-align:center}
    #tree-wrap{display:inline-block;padding:16px;background:linear-gradient(180deg,#071116,#0b1620);border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    /* SVG tree styles */
    .tree-svg{width:260px;height:auto}

    /* twinkling lights */
    .light{filter:drop-shadow(0 0 8px rgba(214,40,40,0.6))}
    @keyframes twinkle{0%{opacity:0.2;transform:scale(0.9)}50%{opacity:1;transform:scale(1.08)}100%{opacity:0.25;transform:scale(0.95)}}
    .light--a{animation:twinkle 1.6s infinite ease-in-out}
    .light--b{animation:twinkle 1.9s infinite ease-in-out}
    .light--c{animation:twinkle 2.2s infinite ease-in-out}

    /* ornaments (wish) */
    .ornament{cursor:pointer;transition:transform .2s}
    .ornament:hover{transform:scale(1.06)}

    /* wish list */
    #wishList{max-width:460px;margin:12px auto;text-align:left}
    .wish-item{background:rgba(255,255,255,0.03);padding:10px;margin:8px 0;border-radius:8px;border-left:4px solid var(--red)}

    /* controls */
    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}

    /* download buttons */
    .download-btn{background:var(--red);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}

    /* recap */
    #recap{display:none}
    .recap-slider{display:flex;gap:12px;overflow:hidden}
    .recap-slide{min-width:100%;transition:transform .4s}

    /* responsive */
    @media (max-width:640px){.tree-svg{width:200px}}

    /* snow (canvas) overlay */
    #snow-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:50}

    /* subtle glow around cards */
    .glow{box-shadow:0 8px 40px rgba(214,40,40,0.12)}

  </style>
</head>
<body>

<div class="wrap">
  <!-- NAME POPUP -->
  <div id="nameModal">
    <div class="modal-card">
      <h2>Masukkan Nama Kamu</h2>
      <input id="username" placeholder="Nama kamu (mis. Budi)" />
      <div style="margin-top:10px;color:var(--muted)">Nama akan tampil di kartu ucapanmu.</div>
      <button class="btn" id="btnStart">Mulai</button>
    </div>
  </div>

  <!-- GREETING CARD -->
  <div id="greetingCard" class="card small center">
    <div class="inner">
      <div class="card-title">Selamat Natal & Tahun Baru</div>
      <h1 id="greetName" style="margin:6px 0 0;font-size:20px"></h1>
      <p class="lead" style="margin-top:8px">Klik kartu ini untuk membuka pesan spesial untukmu.</p>
    </div>
  </div>

  <!-- MESSAGE CARD -->
  <div id="messageCard" class="card">
    <div>
      <div class="card-title">Pesan Hangat</div>
      <p class="lead">Semoga tahun mendatang membawa kebahagiaan, kesehatan, dan kenangan manis. Klik tombol untuk menaruh harapanmu di pohon Natal.</p>
      <div class="controls">
        <button class="btn" id="btnOpenTree">Buka Wish Tree</button>
        <button class="btn" id="btnPlayMusic">Pause Music</button>
      </div>
    </div>
  </div>

  <!-- WISH TREE CARD -->
  <div id="treeCard" class="card center">
    <div id="tree-wrap">
      <!-- SVG tree with lights & ornaments -->
      <svg class="tree-svg" viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg" id="svgTree">
        <!-- trunk -->
        <rect x="92" y="210" width="16" height="40" rx="2" fill="#5b3a2e"></rect>
        <!-- layers of green -->
        <path d="M100 40 C60 70, 40 100, 20 140 L180 140 C160 100,140 70,100 40 Z" fill="#063b1f"></path>
        <path d="M100 80 C70 100,50 120,30 160 L170 160 C150 120,130 100,100 80 Z" fill="#094f29"></path>
        <path d="M100 120 C80 130,70 150,50 190 L150 190 C130 150,120 130,100 120 Z" fill="#0b6b37"></path>

        <!-- lights (small circles) -->
        <circle class="light light--a" cx="60" cy="110" r="3" fill="#ffd166"></circle>
        <circle class="light light--b" cx="140" cy="90" r="3" fill="#ffd166"></circle>
        <circle class="light light--c" cx="100" cy="150" r="3" fill="#ffd166"></circle>

        <!-- ornaments group -->
        <g id="ornaments"></g>

        <!-- star -->
        <polygon points="100,18 107,34 124,34 110,44 116,60 100,50 84,60 90,44 76,34 93,34" fill="#ffd166'" opacity="0.95"></polygon>
      </svg>

      <div style="margin-top:12px">
        <input id="wishInput" placeholder="Tulis wish... (bisa banyak)" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);width:260px;background:transparent;color:inherit">
        <button class="btn" id="addWish">Tambah</button>
      </div>

      <div id="wishList"></div>

      <div class="controls" style="margin-top:12px">
        <button class="download-btn" id="downloadCardBtn">Download Card (PNG)</button>
        <button class="download-btn" id="downloadTreeBtn">Download Tree (PNG)</button>
      </div>
    </div>
  </div>

  <!-- RECAP -->
  <div id="recap" class="card">
    <div class="card-title">Recap Tahun Ini</div>
    <div class="recap-slider" id="recapSlider" style="overflow:hidden;position:relative">
      <div class="recap-slide" id="recapInner" style="display:flex;transition:transform .45s">
        <!-- slides injected -->
      </div>
    </div>
    <div class="controls" style="margin-top:12px">
      <button class="btn" id="prevSlide">Prev</button>
      <button class="btn" id="nextSlide">Next</button>
    </div>
  </div>

</div>

<!-- canvas for snow -->
<canvas id="snow-canvas"></canvas>

<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5l3zXG2oGm1p3+Yy6sQqkBq8q6Qq1z0qv6U8aA9p1XbQk2n5oJmGvZbX1YcM5f3ZQe6jJ2E7V7e3b6+Qx1w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
  // ---------- small helper ----------
  const nameModal = document.getElementById('nameModal');
  const btnStart = document.getElementById('btnStart');
  const greetCard = document.getElementById('greetingCard');
  const messageCard = document.getElementById('messageCard');
  const treeCard = document.getElementById('treeCard');
  const recapCard = document.getElementById('recap');
  const greetName = document.getElementById('greetName');
  const btnOpenTree = document.getElementById('btnOpenTree');
  const btnPlayMusic = document.getElementById('btnPlayMusic');

  // music (replace src with your file path)
  const music = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_9b8a1b6e4f.mp3?filename=relaxing-guitar-111409.mp3');
  music.loop = true; music.volume = 0.6; music.play().catch(()=>{});
  let musicPlaying = true;
  btnPlayMusic.addEventListener('click', ()=>{
    if(musicPlaying){ music.pause(); btnPlayMusic.innerText = 'Play Music'; }
    else { music.play(); btnPlayMusic.innerText = 'Pause Music'; }
    musicPlaying = !musicPlaying;
  });

  // snow canvas
  const canvas = document.getElementById('snow-canvas'); const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  addEventListener('resize', resize); resize();
  let flakes = [];
  function initSnow(n=140){ flakes = []; for(let i=0;i<n;i++){ flakes.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*3+1,d:Math.random()*1.5+0.5,spd:Math.random()*0.8+0.2}) }}
  function renderSnow(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='rgba(255,255,255,0.9)'; flakes.forEach(f=>{ ctx.beginPath(); ctx.arc(f.x,f.y,f.r,0,Math.PI*2); ctx.fill(); f.y += f.spd + f.d; f.x += Math.sin(f.y/30)*0.6; if(f.y>canvas.height){ f.y = -10; f.x = Math.random()*canvas.width } }); requestAnimationFrame(renderSnow); }
  initSnow(160); renderSnow();

  // flow: name -> greeting -> message -> tree -> recap
  btnStart.onclick = ()=>{
    const name = document.getElementById('username').value.trim();
    if(!name) return alert('Isi nama dulu ya');
    nameModal.style.display='none';
    greetName.innerText = name;
    greetCard.style.display='block';
  }
  greetCard.onclick = ()=>{ greetCard.style.display='none'; messageCard.style.display='block'; messageCard.classList.add('glow'); setTimeout(()=>messageCard.classList.remove('glow'),900)}
  btnOpenTree.onclick = ()=>{ messageCard.style.display='none'; treeCard.style.display='block'; }

  // ornaments / wishes
  const ornamentsGroup = document.getElementById('ornaments');
  const wishInput = document.getElementById('wishInput');
  const addWishBtn = document.getElementById('addWish');
  const wishListEl = document.getElementById('wishList');
  let wishes = [];

  function placeOrnament(text){
    // create small circle at random position on tree
    const cx = 40 + Math.random()*120; const cy = 60 + Math.random()*120; const r = 6 + Math.random()*6;
    const color = ['#d62828','#ffd166','#ffffff'][Math.floor(Math.random()*3)];
    const id = 'orn'+Date.now()+Math.floor(Math.random()*1000);
    const el = document.createElementNS('http://www.w3.org/2000/svg','circle');
    el.setAttribute('cx',cx); el.setAttribute('cy',cy); el.setAttribute('r',r); el.setAttribute('fill',color);
    el.setAttribute('class','ornament'); el.setAttribute('data-text',text); el.setAttribute('id',id);
    el.addEventListener('click', ()=>{ alert('Wish: '+text); });
    ornamentsGroup.appendChild(el);
  }

  function renderWishList(){ wishListEl.innerHTML=''; wishes.forEach((w,i)=>{ const d=document.createElement('div'); d.className='wish-item'; d.innerHTML = `<strong>${i+1}.</strong> ${w}`; wishListEl.appendChild(d); }); }

  addWishBtn.onclick = ()=>{
    const v = wishInput.value.trim(); if(!v) return alert('Tulis harapan dulu');
    wishes.push(v); placeOrnament(v); renderWishList(); wishInput.value='';
  }

  // allow multiple wishes quickly: pressing Enter in input adds
  wishInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); addWishBtn.click(); } });

  // DOWNLOAD using html2canvas
  const downloadCardBtn = document.getElementById('downloadCardBtn');
  const downloadTreeBtn = document.getElementById('downloadTreeBtn');

  downloadCardBtn.addEventListener('click', async ()=>{
    // capture the message card + greeting name as a single image
    // temporarily show greeting + message together
    const wrapper = document.createElement('div');
    wrapper.style.padding='20px'; wrapper.style.background='#070707'; wrapper.style.color='#fff'; wrapper.style.width='800px'; wrapper.style.maxWidth='90%'; wrapper.style.borderRadius='16px';
    // clone greeting
    const greet = document.getElementById('greetingCard').cloneNode(true);
    greet.style.display='block'; greet.classList.remove('small');
    const msg = document.getElementById('messageCard').cloneNode(true); msg.style.display='block';
    wrapper.appendChild(greet); wrapper.appendChild(msg);
    document.body.appendChild(wrapper);
    try{
      const canvas = await html2canvas(wrapper, {useCORS:true, scale:2});
      const data = canvas.toDataURL('image/png');
      const a = document.createElement('a'); a.href=data; a.download = 'card-'+Date.now()+'.png'; a.click();
    }catch(err){ alert('Gagal generate image: '+err); }
    wrapper.remove();
  });

  downloadTreeBtn.addEventListener('click', async ()=>{
    // capture the tree-wrap element
    const el = document.getElementById('tree-wrap');
    try{
      const canvas = await html2canvas(el, {useCORS:true, scale:2});
      const data = canvas.toDataURL('image/png');
      const a = document.createElement('a'); a.href=data; a.download = 'wish-tree-'+Date.now()+'.png'; a.click();
    }catch(err){ alert('Gagal generate tree: '+err); }
  });

  // RECAP slider (simple). Use placeholder images.
  const recapInner = document.getElementById('recapInner');
  const recapImages = [];
  for(let i=1;i<=6;i++){ // 6 sample slides
    const url = `https://picsum.photos/seed/recap${i}/900/500`;
    recapImages.push(url);
  }
  recapImages.forEach(u=>{ const s=document.createElement('div'); s.style.minWidth='100%'; s.innerHTML = `<img src="${u}" style="width:100%;height:auto;border-radius:10px;display:block">`; recapInner.appendChild(s); });
  let slideIndex = 0; function showSlide(idx){ recapInner.style.transform = `translateX(-${idx*100}%)`; }
  document.getElementById('nextSlide').onclick = ()=>{ slideIndex = Math.min(slideIndex+1, recapImages.length-1); showSlide(slideIndex); };
  document.getElementById('prevSlide').onclick = ()=>{ slideIndex = Math.max(slideIndex-1, 0); showSlide(slideIndex); };

  // when done (user clicks Finish), show recap
  function goToRecap(){ treeCard.style.display='none'; recapCard.style.display='block'; }
  // add finish behavior when user downloads or clicks some finish
  document.getElementById('downloadTreeBtn').addEventListener('click', ()=>{ setTimeout(goToRecap,700); });

  // initial: hide message & tree & recap until flow
  messageCard.style.display = 'none'; treeCard.style.display='none'; recapCard.style.display='none';

  // small polish: automatically show message card when greeting clicked (already done)

  // expose goToRecap for other flows
  window.goToRecap = goToRecap;

</script>
</body>
</html>
